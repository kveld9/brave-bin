pkgname=brave-bin
version=1.73.104
revision=1
epoch=1
short_desc='Web browser that blocks ads and trackers by default.'
maintainer="kveld9 <kveld9@disroot.org>"
archs="x86_64"
homepage="https://brave.com"
license="Mozilla Public License Version 2.0"
depends="alsa-lib gtk+3 libXScrnSaver nss"
makedepends="unzip"
provides="${pkgname%-bin}=$version brave-browser"
conflicts="${pkgname%-bin}"
nostrip="yes"
wrksrc="${pkgname}-${version}"
distfiles="https://github.com/brave/brave-browser/releases/download/v${version}/brave-browser-${version}-linux-amd64.zip"
checksum='d1c8e91cb19b5ec8e5a9bdd0a86ad53ed2b1ce29e8d287b9892426016b3df25c'

do_fetch() {
    mkdir -p "${XBPS_SRCPKGDIR}/${pkgname}/files"
    cd "${XBPS_SRCPKGDIR}/${pkgname}/files"
    if [ $? -ne 0 ]; then
        echo "Error: ZIP file not found."
        exit 1
    fi
}

do_extract() {
    mkdir -p "${wrksrc}"
    cd "${wrksrc}"
    unzip "${XBPS_SRCPKGDIR}/${pkgname}/files/brave-browser-${version}-linux-amd64.zip"
    cp "${XBPS_SRCPKGDIR}/${pkgname}/files/${pkgname}.sh" "${wrksrc}/${pkgname}.sh"
    cp "${XBPS_SRCPKGDIR}/${pkgname}/files/brave-browser.desktop" "${wrksrc}/brave-browser.desktop"
}

do_install() {
    install -dm755 "${PKGDESTDIR}/usr/bin/brave"
    install -Dm755 "${wrksrc}/${pkgname}.sh" "${PKGDESTDIR}/usr/bin/brave/brave-bin.sh"
    install -Dm644 "${wrksrc}/brave-browser.desktop" "${PKGDESTDIR}/usr/share/applications/brave-browser.desktop"
    install -Dm644 "${wrksrc}/LICENSE" "${PKGDESTDIR}/usr/share/licenses/$pkgname/LICENSE"

    install -dm0755 "${PKGDESTDIR}/opt/$pkgname"
    cp -a "${wrksrc}/"* "${PKGDESTDIR}/opt/$pkgname/"
    chmod 4755 "${PKGDESTDIR}/opt/$pkgname/chrome-sandbox"
}

post_remove() {
    vuninstall brave
}
